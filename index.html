<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Western Holiday Lighting | Boise–Nampa Christmas Light Installation</title>
  <meta name="description" content="Professional, insured Christmas light installation across Treasure Valley." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <!-- Netlify Identity (for CMS login/invite) -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

  <style>
    :root{
      --bg:#0b1220; --bg2:#0f1a33; --brand:#0ea5e9; --accent:#22d3ee; --text:#e5f0ff; --muted:#98a6bd; --card:#0e162b;
      --xmasRed:#ef4444; --xmasGreen:#22c55e; --gold:#facc15;

      /* layout + easy knobs */
      --content-max: 1100px;     /* matches .container max-width */
      --logo-desktop: 384px;     /* desktop logo height */
      --logo-trim-d: -56px;      /* desktop trim (more negative = tighter) */
      --logo-mobile-w: 70vw;     /* mobile logo width (centered) */
      --logo-top-m: 18px;        /* push logo DOWN on mobile */
      --logo-bottom-m: -84px;    /* tighten space under logo on mobile */
      --h1-max: 42px;            /* max H1 size */
      --badge-font: 0.95rem;
      --badge-pad-y: 6px;
      --badge-pad-x: 12px;

      /* dynamic (set by JS) */
      --header-h: 260px;         /* actual header height gets measured */
      --side-gutter: max(0px, calc((100vw - var(--content-max)) / 2));
    }

    *{box-sizing:border-box}
    html,body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:var(--accent);text-decoration:none}

    /* ===== Header with optional background image (NOT sticky) ===== */
    .header-hero{
      position: relative; /* scrolls with page */
      background: rgba(10,15,28,.7); /* fallback if no image */
      border-bottom:1px solid rgba(255,255,255,.06);
      backdrop-filter:saturate(130%) blur(8px);
      background-image: var(--header-bg, none); /* set by JS from CMS */
      background-size: cover; background-position: center; background-repeat: no-repeat;
      z-index: 10; /* below snow (40), below cards/CTA (55/60) */
    }
    .header-overlay{
      position: absolute; inset: 0; z-index: 1;
      background: rgba(0,0,0,.35); /* darken photo so logo/buttons pop */
      pointer-events: none;
    }

    .container{max-width:var(--content-max);margin:0 auto;padding:0 20px}

    /* compact header bar */
    .nav{position:relative; z-index:2; display:flex;align-items:center;justify-content:space-between;padding:0}
    .logo-wrap{display:flex;align-items:center;gap:0}

    /* BIG logo (desktop) */
    .logo{
      height:var(--logo-desktop);
      width:auto; display:block;
      margin-block: var(--logo-trim-d);
    }

    header .cta{gap:10px;flex-wrap:wrap}
    .btn{
      display:inline-block;padding:12px 18px;border-radius:12px;
      background:linear-gradient(135deg,var(--xmasRed),var(--xmasGreen));
      color:#052030;font-weight:800;letter-spacing:.3px;
      box-shadow:0 6px 18px rgba(239,68,68,.15),0 2px 8px rgba(34,197,94,.15)
    }
    .btn.outline{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.15)}

    /* hero layout */
    .hero{display:grid;grid-template-columns:1.1fr .9fr;gap:28px;padding:14px 0 32px}
    @media (max-width:900px){.hero{grid-template-columns:1fr}}

    /* locations pill */
    .badge{
      display:inline-block;
      font-size:var(--badge-font);
      padding:var(--badge-pad-y) var(--badge-pad-x);
      margin:6px 0 14px 0;
      border-radius:999px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
    }

    /* H1 size & spacing */
    .hero h1{font-size:clamp(26px,3.3vw,var(--h1-max));line-height:1.08;margin:6px 0 10px}
    .hero p{color:var(--muted);font-size:1.02rem;margin-top:4px}

    /* Cards (shielded from snow via z-index) */
    .card{
      background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:18px;
      position: relative; z-index:55; /* ABOVE snow (z:40) */
    }
    /* Utility: add class="shield" on any block you want above the snow */
    .shield{ position: relative; z-index:55; }

    .grid{display:grid;gap:16px}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    @media (max-width:900px){.grid.cols-3{grid-template-columns:1fr}}
    h2{font-size:clamp(22px,3vw,34px);margin:8px 0 6px}
    .muted{color:var(--muted)}
    .badges{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .section{padding:44px 0}
    .price{font-size:28px;font-weight:800}
    .from{color:var(--muted);font-size:.9rem}
    .list{margin:10px 0 0;padding:0 0 0 18px;color:var(--text)}
    .cta{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px}
    .bar{margin:20px 0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.18),transparent)}
    .gallery{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
    @media (max-width:900px){.gallery{grid-template-columns:repeat(3,1fr)}}
    .gallery figure{aspect-ratio:1;border-radius:12px;background:#0d1b2a;border:1px dashed rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;color:#99a;margin:0;overflow:hidden}
    .gallery img{max-width:100%;max-height:100%;display:block}
    form{display:grid;gap:12px}
    input,select,textarea{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0b1426;color:var(--text)}
    .disclaimer{font-size:.85rem;color:#a7b5cc}
    footer{padding:40px 0;color:#9db4d6; position:relative; z-index:55;}

    /* Floating CTA (desktop right; mobile centered) */
    .floating-cta{
      position:fixed; right:16px; bottom:16px; z-index:60;
      display:inline-flex; align-items:center; gap:10px;
      padding:12px 16px; border-radius:999px; font-weight:800; letter-spacing:.3px;
      background:linear-gradient(135deg,var(--xmasRed),var(--xmasGreen)); color:#052030;
      box-shadow:0 10px 22px rgba(0,0,0,.35), 0 4px 10px rgba(0,0,0,.25);
      transition:opacity .25s ease, transform .25s ease;
      text-decoration:none;
    }
    .floating-cta.hidden{ opacity:0; transform:translateY(16px); pointer-events:none; }

    /* ===== Snow system: TOP (header only) + SIDES (outside container) ===== */
    /* These layers sit UNDER the content (z:40 vs cards/shields z:55) */
    .snow-top, .snow-left, .snow-right{
      position: fixed; pointer-events:none; z-index:40; overflow:hidden;
    }
    /* top snow covers just the header height (measured by JS) */
    .snow-top{ top:0; left:0; width:100vw; height:var(--header-h); }
    /* side snows fill left/right gutters outside the container */
    .snow-left{ top:0; left:0; width:var(--side-gutter); height:100vh; }
    .snow-right{ top:0; right:0; width:var(--side-gutter); height:100vh; }

    /* individual flakes */
    .flake{
      position:absolute; top:-2rem; font-size:1.1rem; color:#fff; opacity:.85;
      will-change: top, transform;
      animation: snow-fall linear infinite, snow-drift ease-in-out infinite;
    }
    @keyframes snow-fall{ from{ top:-2rem; } to{ top:110vh; } }
    @keyframes snow-drift{ 0%,100%{ transform: translateX(0); } 50%{ transform: translateX(18px); } }

    /* sprinkle positions/delays (10 per layer) */
    .flake:nth-child(1){ left:5%;  animation-duration:11s,5s;  animation-delay:0s,.5s;}
    .flake:nth-child(2){ left:15%; animation-duration:13s,6s;  animation-delay:2s,0s;}
    .flake:nth-child(3){ left:25%; animation-duration:12s,4.5s;animation-delay:1s,.2s;}
    .flake:nth-child(4){ left:35%; animation-duration:10s,5.2s;animation-delay:3s,.3s;}
    .flake:nth-child(5){ left:45%; animation-duration:14s,6.5s;animation-delay:.5s,.4s;}
    .flake:nth-child(6){ left:55%; animation-duration:12.5s,6s;animation-delay:1.5s,.7s;}
    .flake:nth-child(7){ left:65%; animation-duration:11.5s,5.5s;animation-delay:2.5s,.1s;}
    .flake:nth-child(8){ left:75%; animation-duration:13.5s,6.2s;animation-delay:.8s,.6s;}
    .flake:nth-child(9){ left:85%; animation-duration:12s,5.8s; animation-delay:1.2s,.4s;}
    .flake:nth-child(10){left:50%; animation-duration:15s,7s;  animation-delay:.3s,.9s;}

    /* responsive tweaks */
    @media (max-width:1100px){
      .logo{height:320px;margin-block:-26px}
    }
    @media (max-width:780px){
      .nav{flex-direction:column;align-items:center;gap:6px;padding:2px 0}
      .logo-wrap{width:100%;justify-content:center}
      .logo{
        width: var(--logo-mobile-w);
        height: auto;
        margin-top: var(--logo-top-m);       /* push DOWN */
        margin-bottom: var(--logo-bottom-m); /* tighten space under */
      }
      .badge{font-size:calc(var(--badge-font) - .05rem);margin-bottom:12px}
      .hero{padding-top:16px}

      /* center the floating CTA on phones */
      .floating-cta{ left:50%; right:auto; bottom:14px; transform:translateX(-50%); }
      .floating-cta.hidden{ transform: translate(-50%, 16px); }
    }

    /* Respect users who prefer less motion */
    @media (prefers-reduced-motion: reduce){
      .flake{ animation: none; }
    }
  </style>
</head>
<body>
  <header class="header-hero">
    <div class="header-overlay"></div>
    <div class="container nav">
      <div class="logo-wrap">
        <img id="logo" class="logo" src="/uploads/logo.png" alt="Western Holiday Lighting logo">
      </div>
      <div class="cta">
        <a id="header_cta_label" class="btn outline" href="#quote">Get an Instant Estimate</a>
        <a id="header_cta_secondary" class="btn" href="tel:+12084093106">Call/Text (208) 409-3106</a>
      </div>
    </div>
  </header>

  <!-- Snow layers: header-only + left/right gutters (no snow over content) -->
  <div class="snow-top" aria-hidden="true">
    <div class="flake">❅</div><div class="flake">❆</div><div class="flake">❅</div><div class="flake">❆</div><div class="flake">❅</div>
    <div class="flake">❆</div><div class="flake">❅</div><div class="flake">❆</div><div class="flake">❅</div><div class="flake">❆</div>
  </div>
  <div class="snow-left" aria-hidden="true">
    <div class="flake">❅</div><div class="flake">❆</div><div class="flake">❅</div><div class="flake">❆</div><div class="flake">❅</div>
    <div class="flake">❆</div><div class="flake">❅</div><div class="flake">❆</div><div class="flake">❅</div><div class="flake">❆</div>
  </div>
  <div class="snow-right" aria-hidden="true">
    <div class="flake">❅</div><div class="flake">❆</div><div class="flake">❅</div><div class="flake">❆</div><div class="flake">❅</div>
    <div class="flake">❆</div><div class="flake">❅</div><div class="flake">❆</div><div class="flake">❅</div><div class="flake">❆</div>
  </div>

  <!-- Floating CTA -->
  <a class="floating-cta" id="floatingCta" href="#quote">Get an Instant Estimate</a>

  <main class="container">
    <section class="hero">
      <!-- Shield hero copy so flakes don't pass through the left text column -->
      <div class="shield">
        <span class="badge" id="areas">Boise • Meridian • Nampa • Kuna • Eagle • Caldwell</span>
        <h1 id="hero_headline">Pro Christmas Light Installation across Boise–Meridian–Nampa</h1>
        <p id="hero_subheadline" class="muted">Lease premium C9 LEDs on custom-cut lines for a perfect fit. Our full-service packages include design, installation, in-season maintenance, takedown, and optional storage.</p>
        <p><strong id="hero_offer">Book by Oct 15 & save $100</strong></p>
        <div class="badges" id="badges"></div>
      </div>

      <div class="card">
        <h2 id="quote">Instant Estimate</h2>
        <p class="muted">Text us your address and a photo of the front of your home for a fast quote, or use this form.</p>
        <form name="quote" method="POST" data-netlify="true" action="/success/">
          <input type="hidden" name="form-name" value="quote" />
          <label>Full Name<input name="name" required></label>
          <label>Mobile Number<input name="phone" required></label>
          <label>Address<input name="address" required placeholder="Street, City"></label>
          <label>Home Type<select name="stories"><option>Single-story</option><option>Two-story</option><option>Split level</option></select></label>
          <label>Extras<select name="extras"><option>None</option><option>Wreath</option><option>Tree wraps</option><option>Walkway stakes</option></select></label>
          <label>Notes<textarea name="notes" rows="3" placeholder="Anything we should know? Gate code, steep roof, etc."></textarea></label>
          <div class="cta">
            <button class="btn" type="submit">Get My Estimate</button>
            <a class="btn outline" id="sms_link" href="sms:+12084093106?&body=Hi%20—%20my%20address%20is%20">Text Us Instead</a>
          </div>
          <p class="disclaimer">We'll send a ballpark quote using satellite & street views, then confirm on-site.</p>
        </form>
      </div>
    </section>

    <section id="packages" class="section shield">
      <h2>Simple Packages</h2>
      <p id="service_summary" class="muted">Transparent, competitive pricing for seasonal installs.</p>
      <div id="packages_wrap" class="grid cols-3"></div>
    </section>

    <section class="section shield">
      <h2>Recent Work</h2>
      <div id="gallery" class="gallery"></div>
    </section>

    <section id="faq" class="section shield">
      <h2>FAQ</h2>
      <div id="faq_wrap" class="grid cols-3"></div>
    </section>

    <section class="section shield">
      <h2>What Neighbors Say</h2>
      <div id="testimonials" class="grid cols-3"></div>
    </section>
  </main>

  <footer class="shield">
    <div class="container">
      <div class="bar"></div>
      <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap">
        <div>© <span id="y"></span> <span id="business_name_footer">Western Holiday Lighting</span></div>
        <div id="footer_line" class="muted">Licensed & Insured • (208) 409-3106 • info@lightsidaho.com</div>
      </div>
    </div>
  </footer>

  <script>
  const $ = (id) => document.getElementById(id);
  const j = async (p) => { try { const r = await fetch(p); if (!r.ok) return null; return await r.json(); } catch(e){ return null; } };

  function text(el,val){ if(el && val!==undefined) el.textContent = val; }
  function attr(el,name,val){ if(el && val) el.setAttribute(name,val); }

  // Measure header height for snow-top and update CSS var
  function setHeaderHeightVar(){
    const header = document.querySelector('.header-hero');
    if (!header) return;
    const h = header.offsetHeight || 260;
    document.documentElement.style.setProperty('--header-h', h + 'px');
  }

  async function init(){
    const site  = await j('/content/site.json');
    const pkgs  = await j('/content/packages.json');
    const faq   = await j('/content/faq.json');
    const testi = await j('/content/testimonials.json');
    const gal   = await j('/content/gallery.json');

    if(site){
      text($('business_name_footer'), site.business_name);
      attr($('logo'), 'src', site.logo || '/uploads/logo.png');

      // header background from CMS
      const headerEl = document.querySelector('.header-hero');
      if (headerEl && site.header_bg) headerEl.style.setProperty('--header-bg', `url(${site.header_bg})`);

      text($('hero_headline'), site.hero_headline);
      text($('hero_subheadline'), site.hero_subheadline);
      text($('hero_offer'), site.hero_offer);
      text($('service_summary'), site.service_summary);
      text($('footer_line'), site.footer_line);
      text($('areas'), (site.areas||[]).join(' • '));
      text($('header_cta_label'), site.header_cta_label);

      const phoneHref = site.phone_href ? 'tel:'+site.phone_href : '';
      const smsHref   = site.phone_href ? 'sms:'+site.phone_href+'?&body=Hi%20—%20my%20address%20is%20' : '';
      if(phoneHref){ $('header_cta_secondary')?.setAttribute('href', phoneHref); }
      if(smsHref){   $('sms_link')?.setAttribute('href', smsHref); }
      if (site.header_cta_secondary) $('header_cta_secondary').textContent = site.header_cta_secondary;
    }

    if(pkgs && Array.isArray(pkgs.packages)){
      $('packages_wrap').innerHTML = pkgs.packages.map(p => `
        <div class="card">
          <h3>${p.title||''}</h3>
          <div class="price">From $${p.price_from||''}</div>
          <div class="from">${p.blurb||''}</div>
          <ul class="list">${(p.includes||[]).map(i=>`<li>${i}</li>`).join('')}</ul>
          <div class="cta"><a class="btn" href="#quote">${p.cta||'Get Quote'}</a></div>
        </div>`).join('');
    }

    if(gal && Array.isArray(gal.images)){
      $('gallery').innerHTML = gal.images.map(it => `
        <figure title="${it.label||''}">
          ${it.image ? `<img src="${it.image}" alt="${it.label||'Gallery'}">` : it.label||'Image'}
        </figure>`).join('');
    }

    if(faq && Array.isArray(faq.faqs)){
      $('faq_wrap').innerHTML = faq.faqs.map(q => `<div class="card"><h3>${q.q||''}</h3><p class="muted">${q.a||''}</p></div>`).join('');
    }

    if(testi && Array.isArray(testi.testimonials)){
      $('testimonials').innerHTML = testi.testimonials.map(x => `<div class="card"><p>"${x.quote||''}"</p><p class="muted">— ${x.name||''}</p></div>`).join('');
    }

    $('y').textContent = new Date().getFullYear();

    // Hide floating CTA when the quote form is in view (so it doesn't overlap)
    const floatBtn = document.getElementById('floatingCta');
    const quoteEl = document.getElementById('quote');
    if (floatBtn && quoteEl && 'IntersectionObserver' in window){
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e => {
          if (e.isIntersecting) floatBtn.classList.add('hidden');
          else floatBtn.classList.remove('hidden');
        });
      }, {rootMargin: '0px 0px -30% 0px', threshold: 0});
      io.observe(quoteEl);
    }

    // Set header height var for top-snow; update on logo load & window resize
    setHeaderHeightVar();
    const logo = document.getElementById('logo');
    if (logo && !logo.complete) { logo.addEventListener('load', setHeaderHeightVar, { once:true }); }
    window.addEventListener('resize', setHeaderHeightVar);
  }
  init();

  // Netlify Identity: forward invite hashes to /admin/, and send logged-in users there
  if (location.hash && location.hash.startsWith('#/invite')) {
    location.href = '/admin/' + location.hash;
  }
  if (window.netlifyIdentity) {
    window.netlifyIdentity.on('init', (user) => {
      if (!user) {
        window.netlifyIdentity.on('login', () => { document.location.href = '/admin/'; });
      }
    });
  }
  </script>
</body>
</html>
